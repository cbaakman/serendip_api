<html>
  <head>
    <script src="http://code.jquery.com/jquery-3.3.1.min.js" type="text/javascript"></script>
    <script type="text/javascript">
      function submitSerendipSequence() {

        var sequence = $("#serendip_sequence_area").val().replace(/\s+/g,"");

        $.post("{{ url_for('api.submit') }}", {'sequence': sequence},
          function(data) {
            // sequence has just been submitted, recieved a job id

            checkStatus(data.jobid);
        });
      }

      function checkStatus(jobid) {

        $.get("{{ url_for('api.status', jobid='xxxxx') }}".replace("xxxxx", jobid),
          function(data) {
            // Recieved a status

            if (data.status == "PENDING" || data.status == "STARTED")
            {
              setTimeout(function(){ checkStatus(jobid); }, 10000);
            }
            else if (data.status == "FAILURE" || data.status == "REVOKED")
            {
              alert(data.error);
            }
            else if (data.status == "SUCCESS")
            {
              retrieveResult(jobid);
            }
        });
      }

      function retrieveResult(jobid)
      {
        $.get("{{ url_for('api.result', jobid='xxxxx') }}".replace("xxxxx", jobid),
          function(data) {
            // Recieved a result

            displayData(data.data);
        });
      }

      var dataHeader = ['AliSeq', 'model1', 'model2', 'model3', 'model4', 'model5', 'average', 'prediction', 'stdev', 'zscore'];

      function displayData(data)
      {
        var table = "<table>";

        table += "<tr>";
        for (var j = 0; j < dataHeader.length; j++)
          table += "<th>" + dataHeader[j] + "</th>";
        table += "</tr>";

        for (var i = 0; i < data.length; i++)
        {
          var record = data[i];
          table += "<tr>";
          for (var j = 0; j < dataHeader.length; j++)
            table += "<td>" + record[dataHeader[j]] + "</td>";
          table += "</tr>";
        }
        table += "</table>";
        $("#serendip_data").html(table);
      }
    </script>
  </head>
  <body>
    <form id="serendip_form" onsubmit="submitSerendipSequence(); return false;">
      <span>Enter a Sequence</span>
      <textarea id="serendip_sequence_area">
      </textarea>
      <input type="submit" value="Submit"></input>
    </form>
    <div id="serendip_data">
    </div>
  </body>
<html>
